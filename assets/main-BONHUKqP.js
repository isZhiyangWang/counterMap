import{L as i}from"./Leaflet.ImageOverlay.Rotated-DBe7n3vG.js";window.scrollGuidedEnabled=!0;function p(a){if(!a.overlayBounds||!a.overlayImage)return null;const t=a.overlayBounds,o=[i.latLng(t[0][0],t[0][1]),i.latLng(t[1][0],t[1][1]),i.latLng(t[3][0],t[3][1]),i.latLng(t[2][0],t[2][1])],e=i.distortableImageOverlay(a.overlayImage,{corners:o,opacity:a.overlayOpacity||.5});return e.once("load",()=>{e._image&&(e._image.style.opacity=(a.overlayOpacity||.5).toString())}),e.addTo(window.map),e}function y(a){let t=0,o=0;return a.forEach(e=>{t+=e[0],o+=e[1]}),[t/a.length,o/a.length]}function L(a){let t=1/0,o=-1/0,e=1/0,d=-1/0;return a.forEach(([r,n])=>{r<t&&(t=r),r>o&&(o=r),n<e&&(e=n),n>d&&(d=n)}),{minLat:t,maxLat:o,minLng:e,maxLng:d}}function v(a,t,o){return a.map(([e,d])=>[e+t,d+o])}window.addEventListener("load",async()=>{const a=document.getElementById("loadingOverlay");try{window.map=i.map("map",{center:[18.5,-72],zoom:7,minZoom:6,maxZoom:20}),i.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"Map data © OpenStreetMap contributors, © CARTO"}).addTo(window.map);const o=await(await fetch("/counterMap/data/mapsData.json")).json(),e={};o.maps.filter(n=>n.type==="region").forEach(n=>{e[n.id]=n}),Object.values(e).forEach(n=>{p(n),n._center=y(n.overlayBounds);const s=L(n.overlayBounds);n._minLng=s.minLng,n._maxLng=s.maxLng}),o.maps.filter(n=>n.type==="town").forEach(n=>{const s=e[n.regionId];if(!s){console.warn("Invalid region ID for town:",n);return}const c=y(n.overlayBounds),l=.005;i.rectangle([[c[0]-l,c[1]-l],[c[0]+l,c[1]+l]],{color:"blue",weight:1}).addTo(window.map);let m=[];const f=.02,{minLng:w,maxLng:h}=L(n.overlayBounds);if(c[1]>=s._center[1]){const g=s._maxLng+f-w;m=v(n.overlayBounds,0,g)}else{const g=s._minLng-f-h;m=v(n.overlayBounds,0,g)}const u=p({...n,overlayBounds:m,overlayOpacity:n.overlayOpacity||.6});u!=null&&u.setZIndex&&u.setZIndex(9999);const B=y(m);i.polyline([c,B],{color:"blue",weight:1}).addTo(window.map)});const r=o.maps.find(n=>n.id===1);if(r){const n=r.overlayBounds,s=i.latLngBounds([[n[0][0],n[0][1]],[n[1][0],n[1][1]],[n[2][0],n[2][1]],[n[3][0],n[3][1]]]);window.map.fitBounds(s,{padding:[10,10]})}E(o.maps),a.classList.add("hidden")}catch(t){console.error("Error loading map:",t),a.classList.add("hidden")}});function E(a){const t=document.getElementById("regionList");t.innerHTML="",a.forEach(o=>{const e=document.createElement("div");e.classList.add("region-card");const d=document.createElement("h3");d.textContent=o.title,e.appendChild(d),e.addEventListener("mouseover",()=>{if(!window.map)return;const r=o.overlayBounds,n=i.latLngBounds([[r[0][0],r[0][1]],[r[1][0],r[1][1]],[r[2][0],r[2][1]],[r[3][0],r[3][1]]]);window.map.flyToBounds(n,{maxZoom:11})}),e.addEventListener("click",()=>{window.location.href=o.detailPage}),t.appendChild(e)})}
