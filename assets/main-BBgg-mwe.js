import{L as d}from"./Leaflet.ImageOverlay.Rotated-B97kzF_d.js";window.scrollGuidedEnabled=!0;function p(t){if(!t.overlayBounds||!t.overlayImage)return null;const o=t.overlayBounds,a=[d.latLng(o[0][0],o[0][1]),d.latLng(o[1][0],o[1][1]),d.latLng(o[3][0],o[3][1]),d.latLng(o[2][0],o[2][1])],e=d.distortableImageOverlay(t.overlayImage,{corners:a,opacity:t.overlayOpacity||.5});return e.once("load",()=>{e._image&&(e._image.style.opacity=(t.overlayOpacity||.5).toString())}),e.addTo(window.map),e}function f(t){let o=0,a=0;return t.forEach(e=>{o+=e[0],a+=e[1]}),[o/t.length,a/t.length]}function v(t){let o=1/0,a=-1/0,e=1/0,r=-1/0;return t.forEach(([l,s])=>{l<o&&(o=l),l>a&&(a=l),s<e&&(e=s),s>r&&(r=s)}),{minLat:o,maxLat:a,minLng:e,maxLng:r}}function w(t,o,a){return t.map(([e,r])=>[e+o,r+a])}window.addEventListener("load",async()=>{const t=document.getElementById("loadingOverlay");try{window.map=d.map("map",{center:[18.5,-72],zoom:7,minZoom:6,maxZoom:20}),d.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"Map data © OpenStreetMap contributors, © CARTO"}).addTo(window.map);const e=await(await fetch("/data/mapsData.json")).json(),r={};e.maps.filter(n=>n.type==="region").forEach(n=>{r[n.id]=n}),Object.values(r).forEach(n=>{p(n),n._center=f(n.overlayBounds);const i=v(n.overlayBounds);n._minLng=i.minLng,n._maxLng=i.maxLng}),e.maps.filter(n=>n.type==="town").forEach(n=>{const i=r[n.regionId];if(!i){console.warn("Invalid region ID for town:",n);return}const c=f(n.overlayBounds),m=.005;d.rectangle([[c[0]-m,c[1]-m],[c[0]+m,c[1]+m]],{color:"blue",weight:1}).addTo(window.map);let g=[];const L=.02,{minLng:h,maxLng:B}=v(n.overlayBounds);if(c[1]>=i._center[1]){const y=i._maxLng+L-h;g=w(n.overlayBounds,0,y)}else{const y=i._minLng-L-B;g=w(n.overlayBounds,0,y)}const u=p({...n,overlayBounds:g,overlayOpacity:n.overlayOpacity||.6});u!=null&&u.setZIndex&&u.setZIndex(9999);const E=f(g);d.polyline([c,E],{color:"blue",weight:1}).addTo(window.map)});const s=e.maps.find(n=>n.id===1);if(s){const n=s.overlayBounds,i=d.latLngBounds([[n[0][0],n[0][1]],[n[1][0],n[1][1]],[n[2][0],n[2][1]],[n[3][0],n[3][1]]]);window.map.fitBounds(i,{padding:[10,10]})}I(e.maps),t.classList.add("hidden")}catch(a){console.error("Error loading map:",a),t.classList.add("hidden")}document.getElementById("scrollToggleCheckbox").addEventListener("change",a=>{window.scrollGuidedEnabled=a.target.checked,console.log("Scroll guided =",window.scrollGuidedEnabled)})});function I(t){const o=document.getElementById("regionList");o.innerHTML="",t.forEach(a=>{const e=document.createElement("div");e.classList.add("region-card"),e.textContent=a.title,e.addEventListener("mouseover",()=>{if(!window.map)return;const r=a.overlayBounds,l=d.latLngBounds([r[2][0],r[0][1]],[r[0][0],r[1][1]]);window.map.flyToBounds(l,{maxZoom:11})}),e.addEventListener("click",()=>{window.location.href=a.detailPage}),o.appendChild(e)})}
